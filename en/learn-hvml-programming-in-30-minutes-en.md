# Learn HVML Programming in 30 Minutes

-- Vincent Wei

**Table of Contents**

[//]:# (START OF TOC)

- [Introduction](#introduction)
- [Build HTML Development Environment](#build-html-development-environment)
   + [Prerequisites](#prerequisites)
   + [Run `Hello, world!` Program](#run-hello-world-program)

[//]:# (END OF TOC)

## Introduction

HVML is the acronym of `Hybrid Virtual Markup Language`. It is a new-style,
general-purpose, and easy-to-learn programming language proposed by
[Vincent Wei], who is the author of the China-first open source project [MiniGUI].

HVML is a programmable markup language. Like HTML, HVML uses markups to define
program structure and data, but unlike HTML, HVML is programmable and dynamic.

The following code shows a simple HVML program which prints `Hello, world!`
in English or Chinese according to the system locale:

```hvml
<!DOCTYPE hvml>

<!--
    $SYS.locale returns the current system locale such as `en_US` or `zh_CN`
    $STR.substr returns a substring of the given string.
-->
<hvml target="html" lang="$STR.substr($SYS.locale, 0, 2)">

    <body>

        <!-- the `test` element checks whether the system locale starts with `zh` -->
        <test with = $STR.starts_with($SYS.locale, 'zh') >

            <h1>我的第一个 HVML 程序</h1>
            <p>世界，您好！</p>

            <!-- If the system locale does not start with `zh` -->
            <differ>
                <h1>My First HVML Program</h1>
                <p>Hello, world!</p>
            </differ>
        </test>

    </body>

</hvml>
```

If you are familiar with HTML, you know that the above code looks like HTML.
For example, the code uses `<` to define a open tag and `</` to define a close
tag, it uses the same synatx as HTML to define the attributes such as `target="html"`, and it also uses `<!--` and `-->` to define comments, and so on.

However, you can also find that the code introduces some intersting stuff:

1. Expressions start with a special `$` character, such as `$STR.substr($SYS.locale, 0, 2)`.
1. Elements having non-HTML tag names such as `hvml`, `test`, and `differ`.
1. A special attribute having name `with` in `test` element.

Although the code does not like any program in C, JavaScript, or other common
programming languages, if you are told that the original design goal of HVML is
to allow developers can easily generate and operate HTML documents without
a web server using JavaScript in a web browser, you can easily guess
what's the code do:

1) The attribute `target="html"` in `hvml` element defines the target document
type of this HVML program: HTML. That is, this HVML program will genenrate a HTML
document.

2) The expression `$STR.substr($SYS.locale, 0, 2)` makes a substring of the
system locale (in pattern `zh_CN` or `en_US`),  and uses the result as the
value of `lang` attribute.

3) The elements defined by HTML tags, such as `body`, `h1`, and `p` will be cloned
to the target document according to the execute path of the HVML program.

4)  The elements `test` and `differ` act like the conditionl control statements
such as `if` and `else` in C or JavaScript. The `test` element uses the expression
defined by `with` attribute, i.e., `$STR.starts_with($SYS.locale, 'zh')`, as
the condition. If the evaluation result of the expression is true, that is,
the system locale starts with `zh`, this HVML program will clone the `h1` and `p`o
elements in `test` element to the target document, and ignore the `differ` elements.
If the evaluation result is false, the elements in `differ` element will
be cloned to the target document.

Therefore, if the system locale is `zh_CN` or `zh_TW` when you execute
the HVML program, the ultimate document generated by the program will look like:

```html
<html lang="zh">

    <head>
    </head>

    <body>
        <h1>我的第一个 HVML 程序</h1>
        <p>世界，您好！</p>
    </body>

</html>
```

But if the system locale is `en_US` or something else which does not
start with `zh`, the ultimate document generated by the program will look like:

```html
<html lang="en">

    <head>
    </head>

    <body>
        <h1>My First HVML Program</h1>
        <p>Hello, world!</p>
    </body>

</html>
```

The original design goal of HVML is to allow developers who are familiar with
C/C++, Python, or other programming languages to easily develop GUI applications
by using Web front-end technologies (such as HTML/SVG, DOM and CSS), instead of
using JavaScript programming language in a web browser or Node.js.

We achieved this design goal and also designed HVML as a new-style and
general-purpose programming language. Now, we can not only use HVML as
a programming language to rapidly develop GUI applications based on Web
front-end technologies in the C/C++ runtime environment, but also use HVML
as a general script language.

For example, you can re-write the above HVML program to print some lines
on your terminal instead of generating a HTML docuement:

```hvml
<!DOCTYPE hvml>

<!--
    $SYS.locale returns the current system locale such as `en_US` or `zh_CN`
    $STR.substr returns a substring of the given string.
-->
<hvml target="void" lang="$STR.substr($SYS.locale, 0, 2)">

    <body>

        <!-- the `test` element checks whether the system locale starts with `zh` -->
        <test with = $STR.starts_with($SYS.locale, 'zh') >
            {{
                 $STEAM.stdout.writelines('我的第一个 HVML 程序');
                 $STEAM.stdout.writelines('世界，您好！');
            }}

            <!-- If the system locale does not start with `zh` -->
            <differ>
                {{
                     $STEAM.stdout.writelines('My First HVML Program');
                     $STEAM.stdout.writelines('Hello, world!');
                }}
            </differ>
        </test>

    </body>

</hvml>
```

When you execute the revised HVML program, it will print the lines
on your terminal instead of generating a HTML document:

```
我的第一个 HVML 程序
世界，您好！
```

or,

```
My First HVML Program
Hello, world!
```

Obviously, HVML differs from any existing programming language you know.

This tutorial will show you the most exciting features of HVML.
You will find you that you can master the basic principles and methods
of HVML programming in a short time.

Let's enjoy it.

## Build HTML Development Environment

### Prerequisites

The HVML community has released an open source HVML interperter called `PurC`.


### Run `Hello, world!` Program

Please save the following contents in a file named `hello-world.hvml` as your
first HVML program in your working directory:

```hvml
<!DOCTYPE hvml>
<hvml target="void">

    $STREAM.stdout.writelines('Hello, world!')

</hvml>
```

To run this HVML program, you can use `purc` in the following way:

```bash
    $ purc hello-world.hvml
```

You will see that your first HVML program prints `Hello, world!`
on your terminal and quit:

```
    Hello, world!
```

You can also run this HVML program directly as a script if you prepend the
following line as the first line in the HVML program:

```
    #!/usr/local/bin/purc
```

After this, run the following command to change the mode of the file to have
the execute permission:

```bash
    $ chmod +x hello.hvml
```

then run `hello.hvml` directly from the command line:

```bash
    $ ./hello.hvml
```

Now, we hope that our HVML program can generate a HTML file instead of
printing to the terminal. For this purpose, we enhance `hello-10.hvml` once more:

```hvml
<!DOCTYPE hvml>
<hvml target="html">
    <head>
        <title>Hello, world!</title>
    <head>

    <body>
        <ul>
            <iterate on 0 onlyif $L.lt($0<, 10) with $EJSON.arith('+', $0<, 1) >
                <li>$?) Hello, world! --from COROUTINE-$CRTN.cid</li>
            </iterate>
        </ul>
    </body>
</hvml>
```

and save the contents in `hello-html.hvml` file. Note that there are two key
differences:

1. The value of `target` attribute of `hvml` element changed to `html`.
1. We used HTML tags such as `head`, `body`, `ul`, and `li` directly in
   the HVML program.

If you run `hello-html.hvml` program by using `purc` without any option, `purc`
will use the renderer called `HEADLESS`. This renderer will record the messages
sent by PurC to the renderer to a local file. Because this revised HVML program
did not use `$STREM.stdout` any more, you will see nothing on your terminal.
But you can use the option `--verbose` (or the short option `-b`) to show the
HTML contents generated by the HVML program in your terminal:

```bash
    $ purc -b hello-html.hvml
```

The command will give you the following output:

```
purc 0.8.0
Copyright (C) 2022 FMSoft Technologies.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Executing HVML program from `file:///srv/devel/hvml/purc/build/hvml/hello-html.hvml`...

>> The document generated:
<html>
  <head>
    <title>
      Hello, world!
    </title>
  </head>
  <body>
    <ul>
      <li>
        0) Hello, world! --from COROUTINE-3
      </li>
      <li>
        1) Hello, world! --from COROUTINE-3
      </li>
      <li>
        2) Hello, world! --from COROUTINE-3
      </li>
      <li>
        3) Hello, world! --from COROUTINE-3
      </li>
      <li>
        4) Hello, world! --from COROUTINE-3
      </li>
      <li>
        5) Hello, world! --from COROUTINE-3
      </li>
      <li>
        6) Hello, world! --from COROUTINE-3
      </li>
      <li>
        7) Hello, world! --from COROUTINE-3
      </li>
      <li>
        8) Hello, world! --from COROUTINE-3
      </li>
      <li>
        9) Hello, world! --from COROUTINE-3
      </li>
    </ul>
  </body>
</html>


>> The execute result:
null
```

However, we need to enhace the HVML program once more, in order that the program
will not exit immediately after generated the HTML contents. Otherwise,
the window created by xGUI Pro for this HVML program will disappeared
after `purc` exited.

We enhance `hello-html.hvml` to install a timer and update the document and
save it as `hello-html-timer.hvml`:

```hvml
<!DOCTYPE hvml>
<hvml target="html">
    <head>
        <title>My First HVML Program</title>

        <update on="$TIMERS" to="unite">
            [
                { "id" : "clock", "interval" : 500, "active" : "yes" },
            ]
        </update>
    </head>

    <body>
        <h1>My First HVML Program</h1>
        <p>Current Time: <span id="clock">$DATETIME.time_prt()</span></p>

        <ul>
            <iterate on 0 onlyif $L.lt($0<, 10) with $EJSON.arith('+', $0<, 1L) nosetotail >
                <li>$<) Hello, world! --from COROUTINE-$CRTN.cid</li>
            </iterate>
        </ul>

        <observe on $TIMERS for "expired:clock">
            <update on "#clock" at "textContent" to "displace" with "$DATETIME.time_prt()" />
        </observe>

        <observe on $CRTN for "rdrState:closed">
            <exit with "closed" />
        </observe>

    </body>
</hvml>
```

[Beijing FMSoft Technologies Co., Ltd.]: https://www.fmsoft.cn
[FMSoft Technologies]: https://www.fmsoft.cn
[FMSoft]: https://www.fmsoft.cn
[HybridOS Official Site]: https://hybridos.fmsoft.cn
[HybridOS]: https://hybridos.fmsoft.cn

[HVML]: https://github.com/HVML
[MiniGUI]: http:/www.minigui.com
[WebKit]: https://webkit.org
[HTML 5.3]: https://www.w3.org/TR/html53/
[DOM Specification]: https://dom.spec.whatwg.org/
[WebIDL Specification]: https://heycam.github.io/webidl/
[CSS 2.2]: https://www.w3.org/TR/CSS22/
[CSS Box Model Module Level 3]: https://www.w3.org/TR/css-box-3/

[Vincent Wei]: https://github.com/VincentWei

[React.js]: https://reactjs.org
[Vue.js]: https://vuejs.org

[HVML Specifiction V1.0]: https://github.com/HVML/hvml-docs/blob/master/zh/hvml-spec-v1.0-zh.md
[HVML Predefined Variables V1.0]: https://github.com/HVML/hvml-docs/blob/master/zh/hvml-spec-predefined-variables-v1.0-zh.md

